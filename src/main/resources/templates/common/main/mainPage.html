<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>intlearn</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <style>
        /* ê¸°ë³¸ í°íŠ¸ ë° ìŠ¤íƒ€ì¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Swiper Custom Styles */
        .swiper {
            width: 100%;
            height: 100%;
        }

        .swiper-pagination-bullet-active {
            background-color: #10b981 !important;
            /* Emerald-500 */
        }

        .swiper-button-next,
        .swiper-button-prev {
            color: white !important;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .swiper-button-next:hover,
        .swiper-button-prev:hover {
            opacity: 1;
        }

        /* Fade In Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* ===== í† ìŠ¤íŠ¸ ì•Œë¦¼ ===== */
        #toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            color: white;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            animation: slideInRight 0.3s ease-out forwards;
            min-width: 220px;
        }

        .toast.success {
            background-color: #10b981;
        }

        .toast.warn {
            background-color: #f59e0b;
        }

        .toast.error {
            background-color: #ef4444;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }

            to {
                opacity: 0;
                transform: translateX(20px);
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900 selection:bg-emerald-100">

    <!-- Header (mainHeader fragment) -->
    <div th:replace="~{fragments/mainHeader :: header}"></div>

    <main>
        <!-- Swiper Banner: Full Width Background, Content Centered -->
        <div class="relative overflow-hidden bg-slate-900">
            <div class="swiper mySwiper h-[320px] md:h-[380px]">
                <div class="swiper-wrapper">

                    <!-- Slide 1 -->
                    <div class="swiper-slide relative bg-slate-900">
                        <!-- max-w-screen-xl mx-auto ë¡œ ì½˜í…ì¸  ì¤‘ì•™ ì •ë ¬ -->
                        <div class="max-w-screen-xl mx-auto px-4 h-full flex flex-col justify-center relative z-10">
                            <div class="max-w-2xl">
                                <span
                                    class="bg-emerald-500 text-white text-[11px] font-bold px-2 py-1 rounded mb-4 inline-block tracking-wide">EVENT</span>
                                <h1 class="text-3xl md:text-5xl text-white font-bold mb-4 leading-tight">
                                    2026ë…„,<br>ë‹¹ì‹ ì˜ ì„±ì¥ì„ ì‘ì›í•©ë‹ˆë‹¤.
                                </h1>
                                <p class="text-gray-300 mb-8 text-base md:text-lg">
                                    ìµœê³ ì˜ ê°•ì‚¬ì§„ê³¼ í•¨ê»˜í•˜ëŠ” ì‹¤ì „ ì¤‘ì‹¬ì˜ ì»¤ë¦¬í˜ëŸ¼.<br>
                                    ì§€ê¸ˆ ì‹œì‘í•˜ë©´ ìˆ˜ê°•ë£Œ ìµœëŒ€ 30% í• ì¸ í˜œíƒê¹Œì§€!
                                </p>
                                <button
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded transition-colors text-sm md:text-base">
                                    ê°•ì˜ ë³´ëŸ¬ê°€ê¸°
                                </button>
                            </div>
                        </div>
                        <div
                            class="absolute top-0 right-0 w-[500px] h-[500px] bg-emerald-500 rounded-full opacity-10 translate-x-1/4 -translate-y-1/4 blur-3xl pointer-events-none">
                        </div>
                    </div>

                    <!-- Slide 2 -->
                    <div class="swiper-slide relative bg-[#1e1b4b]"> <!-- Indigo-950 -->
                        <div class="max-w-screen-xl mx-auto px-4 h-full flex flex-col justify-center relative z-10">
                            <div class="max-w-2xl">
                                <span
                                    class="bg-yellow-400 text-indigo-900 text-[11px] font-bold px-2 py-1 rounded mb-4 inline-block tracking-wide">NEW
                                    CLASS</span>
                                <h1 class="text-3xl md:text-5xl text-white font-bold mb-4 leading-tight">
                                    GPT-5ì™€ í•¨ê»˜í•˜ëŠ”<br>AI ì•± ê°œë°œ ë§ˆìŠ¤í„°
                                </h1>
                                <p class="text-indigo-200 mb-8 text-base md:text-lg">
                                    í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ë¶€í„° API ì—°ë™ê¹Œì§€.<br>
                                    ë‚˜ë§Œì˜ AI ì„œë¹„ìŠ¤ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ë³´ì„¸ìš”.
                                </p>
                                <button
                                    class="bg-white hover:bg-gray-100 text-indigo-900 font-bold py-3 px-8 rounded transition-colors text-sm md:text-base">
                                    ìì„¸íˆ ë³´ê¸°
                                </button>
                            </div>
                        </div>
                        <div
                            class="absolute bottom-0 right-20 w-96 h-96 bg-pink-500 rounded-full opacity-20 blur-[100px] pointer-events-none">
                        </div>
                    </div>

                    <!-- Slide 3 -->
                    <div class="swiper-slide relative bg-gray-800">
                        <div class="max-w-screen-xl mx-auto px-4 h-full flex flex-col justify-center relative z-10">
                            <div class="max-w-2xl">
                                <span
                                    class="bg-blue-500 text-white text-[11px] font-bold px-2 py-1 rounded mb-4 inline-block tracking-wide">CAREER</span>
                                <h1 class="text-3xl md:text-5xl text-white font-bold mb-4 leading-tight">
                                    ë¹„ì „ê³µìë¥¼ ìœ„í•œ<br>IT ì·¨ì—… ê°€ì´ë“œë¶
                                </h1>
                                <p class="text-gray-400 mb-8 text-base md:text-lg">
                                    í˜„ì§ì 100ëª…ì´ ë§í•˜ëŠ” ë¦¬ì–¼í•œ ì·¨ì—… ì„±ê³µê¸°.<br>
                                    ì§€ê¸ˆ ê°€ì…í•˜ê³  ë¬´ë£Œë¡œ ë°›ì•„ë³´ì„¸ìš”.
                                </p>
                                <button
                                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded transition-colors text-sm md:text-base">
                                    ê°€ì´ë“œë¶ ë°›ê¸°
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="swiper-pagination"></div>
                <!-- Navigation Arrows (Hidden on mobile) -->
                <div class="swiper-button-next hidden md:block"></div>
                <div class="swiper-button-prev hidden md:block"></div>
            </div>
        </div>

        <!-- Main Content: max-w-screen-xl ì ìš©ìœ¼ë¡œ ë„“ì€ ë ˆì´ì•„ì›ƒ -->
        <div class="max-w-screen-xl mx-auto px-4 py-12">

            <!-- Category Filter (í•œì¤„ ì•„ì´ì½˜ ë ˆì´ì•„ì›ƒ) + ì •ë ¬ ë“œë¡­ë‹¤ìš´ -->
            <div class="relative py-4 mb-6 border-b border-gray-200">
                <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì˜ì—­ -->
                <div id="category-container" class="flex items-center justify-center gap-1 overflow-x-auto">
                    <!-- Javascript will populate this -->
                </div>

                <!-- ì •ë ¬ ë“œë¡­ë‹¤ìš´ (ìš°ìƒë‹¨) -->
                <div class="absolute top-3 right-0" style="z-index:10;">
                    <div id="sort-dropdown" class="relative">
                        <button id="sort-toggle-btn"
                            class="flex items-center gap-1 text-sm text-gray-600 font-medium hover:text-gray-900 transition-colors cursor-pointer px-2 py-1">
                            <span id="sort-label">ì¶”ì²œìˆœ</span>
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        <div id="sort-menu"
                            class="hidden absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 min-w-[100px]">
                            <button
                                class="sort-option w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-gray-900 font-bold"
                                data-sort="recommend">ì¶”ì²œìˆœ</button>
                            <button
                                class="sort-option w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-gray-600"
                                data-sort="latest">ìµœì‹ ìˆœ</button>
                            <button
                                class="sort-option w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-gray-600"
                                data-sort="rating">í‰ì ìˆœ</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- course-countëŠ” ìˆ¨ê¸°ë˜ JS ì˜¤ë¥˜ ë°©ì§€ìš©ìœ¼ë¡œ ìœ ì§€ -->
            <span id="course-count" class="hidden">0</span>

            <!-- Course Grid -->
            <!-- Note: 'overflow-visible' allows the hover card to pop out -->
            <div id="course-grid"
                class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-x-6 gap-y-10 min-h-[400px]">
                <!-- Javascript will populate this -->
            </div>

            <!-- Sentinel & Pagination -->
            <div id="scroll-sentinel"
                class="w-full py-12 flex justify-center items-center hidden opacity-0 transition-opacity duration-300">
                <div class="animate-spin rounded-full h-8 w-8 border-4 border-gray-200 border-t-emerald-600"></div>
            </div>

            <div id="pagination-container" class="flex justify-center items-center gap-2 mt-16 hidden">
                <!-- Javascript will populate this -->
            </div>

            <!-- No Results -->
            <div id="no-results"
                class="hidden text-center py-24 bg-white rounded-xl border border-gray-200 mt-6 shadow-sm">
                <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="search" class="text-gray-400 w-8 h-8"></i>
                </div>
                <p class="text-gray-900 font-bold mb-1">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p class="text-gray-500 text-sm mb-6">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ê±°ë‚˜ í•„í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
                <button id="reset-search-btn"
                    class="text-white bg-emerald-600 hover:bg-emerald-700 px-6 py-2 rounded-lg font-bold text-sm transition-colors">
                    ì „ì²´ ê°•ì˜ ë³´ê¸°
                </button>
            </div>
        </div>

    </main>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
    <div id="toast-container"></div>
    <button id="scroll-top-btn"
        class="fixed bottom-8 right-8 z-50 hidden w-12 h-12 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center">
        <i data-lucide="chevron-up" class="w-5 h-5"></i>
    </button>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-12 text-sm text-gray-500">
        <div class="max-w-screen-xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <div>
                    <a href="#" class="flex items-center gap-2 mb-6">
                        <i data-lucide="book-open" class="text-emerald-600 w-6 h-6"></i>
                        <span class="text-xl font-bold text-gray-900">IntLearn</span>
                    </a>
                    <p class="leading-relaxed mb-4">
                        ìš°ë¦¬ëŠ” ëª¨ë‘ì˜ ì„±ì¥ì„ ë¯¿ìŠµë‹ˆë‹¤.<br>
                        ì§€ì‹ì˜ ê³µìœ ë¥¼ í†µí•´ ë” ë‚˜ì€ ì„¸ìƒì„ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.
                    </p>
                    <div class="flex gap-4 mt-6">
                        <a href="#" class="p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><i
                                data-lucide="youtube" class="w-4 h-4 text-gray-600"></i></a>
                        <a href="#" class="p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><i
                                data-lucide="instagram" class="w-4 h-4 text-gray-600"></i></a>
                        <a href="#" class="p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><i
                                data-lucide="facebook" class="w-4 h-4 text-gray-600"></i></a>
                    </div>
                </div>
                <div>
                    <h5 class="font-bold text-gray-900 mb-6 text-base">ì¸ëŸ° ì†Œê°œ</h5>
                    <ul class="space-y-3">
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ì¸ëŸ° ë¬¸í™”</a></li>
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ì±„ìš© ê³µê³ </a></li>
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">íŒŒíŠ¸ë„ˆ ì•ˆë‚´</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-bold text-gray-900 mb-6 text-base">ê³ ê° ì§€ì›</h5>
                    <ul class="space-y-3">
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</a></li>
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ìˆ˜ê°•ì‹ ì²­ ë¬¸ì˜</a></li>
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ê¸°ì—… êµìœ¡ ë¬¸ì˜</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-bold text-gray-900 mb-6 text-base">í¬ë¦¬ì—ì´í„°</h5>
                    <ul class="space-y-3">
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ì§€ì‹ê³µìœ ì ì§€ì›</a></li>
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ê°•ì‚¬ ê°€ì´ë“œ</a></li>
                        <li><a href="#" class="hover:text-emerald-600 transition-colors">ìŠ¤íŠœë””ì˜¤ ëŒ€ê´€</a></li>
                    </ul>
                </div>
            </div>
            <div class="pt-8 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                <p>Â© 2026 IntLearn Inc. All Rights Reserved.</p>
                <div class="flex gap-6">
                    <a href="#" class="hover:text-gray-900 transition-colors">ì´ìš©ì•½ê´€</a>
                    <a href="#" class="font-bold text-gray-900 hover:text-emerald-600 transition-colors">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script th:inline="javascript">
        // --- Data (ì„œë²„ì—ì„œ ì£¼ì…) ---
        const CATEGORIES = [{ id: 'all', name: 'ì „ì²´' }];
        /*[# th:each="cat : ${categories}"]*/
        CATEGORIES.push({ id: [[${ cat.catId }]], name: [[${ cat.catName }]] });
        /*[/]*/

        const COURSES = [];
        /*[# th:each="c : ${courses}"]*/
        COURSES.push({
            id: [[${ c.lectId }]],
            title: [[${ c.title }]],
            instructor: [[${ c.instructor }]],
            price: [[${ c.price }]],
            shortint: [[${ c.shortint }]],
            category: [[${ c.category }]],
            thumbnail: [[${ c.thumbnail }]],
            usercount: [[${ c.usercount }]],
            rating: [[${ c.rating }]],
            reviewCount: [[${ c.reviewCount }]]
        });
        /*[/]*/

        // --- State ---
        let state = {
            activeCategory: 'all',
            searchQuery: '',
            cartCount: 0,
            currentPage: 1,
            page1Limit: 20,
            page1Current: 10,
            pageSize: 20
        };

        // --- DOM Elements ---
        const categoryContainer = document.getElementById('category-container');
        const courseGrid = document.getElementById('course-grid');
        const scrollSentinel = document.getElementById('scroll-sentinel');
        const paginationContainer = document.getElementById('pagination-container');
        const noResults = document.getElementById('no-results');
        const searchInput = document.getElementById('header-search-input');
        const courseCount = document.getElementById('course-count');
        const cartBadge = document.getElementById('cart-badge');
        const resetSearchBtn = document.getElementById('reset-search-btn');
        const scrollTopBtn = document.getElementById('scroll-top-btn');

        // --- Helper Functions ---
        const formatPrice = (price) => price.toLocaleString();
        const getStarsHTML = (rating) => {
            let stars = '';
            for (let i = 0; i < 5; i++) {
                const fill = i < Math.floor(rating) ? 'currentColor' : 'none';
                const color = 'text-yellow-400';
                stars += `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="${fill}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star ${color}"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
            }
            return stars;
        };

        // --- Render Functions ---
        /* ì¹´í…Œê³ ë¦¬ë³„ Lucide ì•„ì´ì½˜ ë§¤í•‘ */
        const CATEGORY_ICONS = {
            'ì „ì²´': 'layout-grid',
            'ë°ì´í„°ë² ì´ìŠ¤': 'database',
            'êµì–‘': 'book-open',
            'ì›¹ í”„ë¡œê·¸ë˜ë°': 'globe',
            'ì¸ê³µì§€ëŠ¥': 'bot',
            'ëª¨ë°”ì¼ ì•±': 'smartphone',
            'ê²Œì„ ê°œë°œ': 'gamepad-2',
            'ë³´ì•ˆ': 'shield-check',
            'ë°ì´í„° ë¶„ì„': 'pie-chart',
            'í´ë¼ìš°ë“œ': 'cloud',
            'ë””ìì¸': 'figma'
        };

        const renderCategories = () => {
            categoryContainer.innerHTML = '';
            CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                const isActive = state.activeCategory === cat.id;

                /* í•œì¤„ ë°°ì¹˜ìš© ì»´íŒ©íŠ¸ ìŠ¤íƒ€ì¼ */
                const baseClasses = "flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg text-xs font-medium transition-all duration-200 select-none whitespace-nowrap min-w-[72px]";
                const activeClasses = "text-emerald-600 font-bold border-b-2 border-emerald-600";
                const inactiveClasses = "text-gray-500 hover:text-gray-900";

                btn.className = `${baseClasses} ${isActive ? activeClasses : inactiveClasses}`;

                /* ì•„ì´ì½˜ + í…ìŠ¤íŠ¸ êµ¬ì¡° */
                const iconName = CATEGORY_ICONS[cat.name] || 'layers';
                btn.innerHTML = `<i data-lucide="${iconName}" class="w-5 h-5 mb-0.5"></i><span>${cat.name}</span>`;

                btn.addEventListener('click', () => {
                    state.activeCategory = cat.id;
                    state.currentPage = 1;
                    state.page1Current = 10;
                    renderCategories();
                    renderCourses(true, true);
                });
                categoryContainer.appendChild(btn);
            });
            lucide.createIcons();
        };

        const renderCourses = (reset = false, scrollToContent = false) => {
            let filtered = COURSES;
            if (state.activeCategory !== 'all') filtered = filtered.filter(c => c.category === state.activeCategory);
            if (state.searchQuery) {
                const query = state.searchQuery.toLowerCase();
                filtered = filtered.filter(c => c.title.toLowerCase().includes(query) || c.instructor.toLowerCase().includes(query));
            }

            courseCount.textContent = filtered.length;

            if (reset) {
                courseGrid.innerHTML = '';
                if (scrollToContent && state.currentPage === 1) window.scrollTo({ top: 400, behavior: 'smooth' });
            }

            let visibleData = [];
            let showSentinel = false;
            let showPagination = false;

            if (state.currentPage === 1) {
                visibleData = filtered.slice(0, state.page1Current);
                if (state.page1Current < state.page1Limit && state.page1Current < filtered.length) {
                    showSentinel = true;
                } else if (filtered.length > state.page1Limit) {
                    showPagination = true;
                }
            } else {
                const startIndex = (state.currentPage - 1) * state.pageSize;
                const endIndex = startIndex + state.pageSize;
                visibleData = filtered.slice(startIndex, endIndex);
                showPagination = true;
            }

            courseGrid.innerHTML = '';

            if (filtered.length === 0) {
                courseGrid.classList.add('hidden');
                noResults.classList.remove('hidden');
                scrollSentinel.classList.add('hidden');
                paginationContainer.classList.add('hidden');
            } else {
                courseGrid.classList.remove('hidden');
                noResults.classList.add('hidden');

                visibleData.forEach(course => {
                    const priceText = course.price === 0 ? 'ë¬´ë£Œ' : `â‚©${formatPrice(course.price)}`;
                    const priceColor = course.price === 0 ? 'text-emerald-600' : 'text-gray-900';
                    const categoryName = CATEGORIES.find(c => c.id === course.category)?.name || '';
                    // ì¸ë„¤ì¼ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ img íƒœê·¸, ì—†ìœ¼ë©´ ê¸°ë³¸ ì•„ì´ì½˜ í‘œì‹œ
                    const thumbHTML = course.thumbnail && course.thumbnail !== '/common/images/lecture_thumb_njwVersion/'
                        ? `<img src="${course.thumbnail}" alt="${course.title}" class="w-full h-full object-cover" onerror="this.parentNode.innerHTML='<i data-lucide=\'book-open\' class=\'text-gray-900 opacity-20 w-20 h-20\'></i>'; lucide.createIcons();">`
                        : `<i data-lucide="book-open" class="text-gray-900 opacity-20 w-20 h-20"></i>`;

                    const cardHTML = `
                        <div class="relative group hover:z-50 h-full">
                            <div class="h-full bg-white rounded-xl overflow-hidden border border-gray-100 flex flex-col">
                                <div class="h-[160px] w-full bg-gray-100 flex items-center justify-center relative overflow-hidden">
                                    ${thumbHTML}
                                </div>
                                <div class="p-4 flex flex-col flex-1">
                                    <h3 class="text-gray-900 font-bold text-base mb-1 line-clamp-2 min-h-[3rem] leading-snug">${course.title}</h3>
                                    <p class="text-gray-500 text-xs mb-3">${course.instructor}</p>
                                    <div class="flex items-center gap-1 mb-3">
                                        <div class="flex text-yellow-400 items-center gap-0.5">${getStarsHTML(course.rating)}</div>
                                        <span class="text-xs font-bold text-gray-700">(${course.reviewCount})</span>
                                    </div>
                                    <div class="mt-auto pt-3 border-t border-gray-100">
                                        <span class="font-bold text-lg ${priceColor}">${priceText}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- POPUP CARD (Overlay) -->
                            <div class="hidden group-hover:block absolute top-[-10px] left-[-10px] w-[calc(100%+20px)] bg-white rounded-xl shadow-2xl border border-gray-200 z-50 animate-fade-in overflow-hidden">
                                <div class="p-5 flex flex-col gap-3">
                                    <div>
                                        <h3 class="text-gray-900 font-bold text-lg leading-snug mb-1">${course.title}</h3>
                                        <div class="flex items-center gap-2 text-xs text-gray-500 mb-2">
                                            <span class="px-2 py-0.5 bg-gray-100 rounded font-bold text-gray-700">${categoryName}</span>
                                            <span>ìˆ˜ê°•ìƒ ${course.usercount}ëª…</span>
                                        </div>
                                    </div>

                                    <p class="text-sm text-gray-600 leading-relaxed">
                                        ${course.shortint}
                                    </p>

                                    <div class="pt-3 border-t border-gray-100 flex items-center justify-between mt-1">
                                        <span class="font-bold text-xl ${priceColor}">${priceText}</span>
                                        <button class="add-to-cart-btn p-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors shadow-sm" data-id="${course.id}" data-title="${course.title}">
                                            <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    courseGrid.insertAdjacentHTML('beforeend', cardHTML);
                });

                document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // data-id ì†ì„±ì—ì„œ ê°•ì˜ ID ê°€ì ¸ì™€ì„œ AJAX ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° í˜¸ì¶œ
                        const lectId = btn.getAttribute('data-id');
                        addToCart(lectId);
                    });
                });

                if (showSentinel) {
                    scrollSentinel.classList.remove('hidden');
                    scrollSentinel.classList.remove('opacity-0');
                    paginationContainer.classList.add('hidden');
                } else {
                    scrollSentinel.classList.add('hidden');
                    if (showPagination) {
                        paginationContainer.classList.remove('hidden');
                        renderPagination(Math.ceil(filtered.length / state.pageSize));
                    } else {
                        paginationContainer.classList.add('hidden');
                    }
                }
            }
            lucide.createIcons();
        };

        const renderPagination = (totalPages) => {
            paginationContainer.innerHTML = '';

            const prevBtn = document.createElement('button');
            prevBtn.innerHTML = `<i data-lucide="chevron-left" class="w-4 h-4"></i>`;
            prevBtn.className = `p-2 rounded-lg border ${state.currentPage === 1 ? 'text-gray-300 border-gray-200 cursor-not-allowed' : 'text-gray-600 border-gray-300 hover:bg-gray-50'}`;
            prevBtn.disabled = state.currentPage === 1;
            prevBtn.onclick = () => {
                if (state.currentPage > 1) {
                    state.currentPage--;
                    if (state.currentPage === 1) state.page1Current = state.page1Limit;
                    renderCourses(true, true);
                }
            };
            paginationContainer.appendChild(prevBtn);

            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = `w-9 h-9 rounded-lg text-sm font-bold border transition-colors ${state.currentPage === i
                    ? 'bg-gray-900 text-white border-gray-900'
                    : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'
                    }`;
                pageBtn.onclick = () => {
                    state.currentPage = i;
                    if (i === 1) state.page1Current = state.page1Limit;
                    renderCourses(true, true);
                };
                paginationContainer.appendChild(pageBtn);
            }

            const nextBtn = document.createElement('button');
            nextBtn.innerHTML = `<i data-lucide="chevron-right" class="w-4 h-4"></i>`;
            nextBtn.className = `p-2 rounded-lg border ${state.currentPage === totalPages ? 'text-gray-300 border-gray-200 cursor-not-allowed' : 'text-gray-600 border-gray-300 hover:bg-gray-50'}`;
            nextBtn.disabled = state.currentPage === totalPages;
            nextBtn.onclick = () => {
                if (state.currentPage < totalPages) {
                    state.currentPage++;
                    renderCourses(true, true);
                }
            };
            paginationContainer.appendChild(nextBtn);

            lucide.createIcons();
        };

        const setupIntersectionObserver = () => {
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && state.currentPage === 1 && state.page1Current < state.page1Limit) {
                    setTimeout(() => {
                        state.page1Current = Math.min(state.page1Current + 10, state.page1Limit);
                        renderCourses(false);
                    }, 500);
                }
            }, { threshold: 0.1 });
            observer.observe(scrollSentinel);
        };

        /**
         * í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
         * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
         * @param {string} type - 'success' | 'warn' | 'error'
         */
        const showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            // íƒ€ì…ë³„ ì•„ì´ì½˜
            const icons = { success: 'âœ“', warn: '!', error: 'âœ•' };
            toast.innerHTML = `<span style="font-size:16px;font-weight:bold;">${icons[type] || '!'}</span><span>${message}</span>`;
            container.appendChild(toast);

            // 2.5ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        };

        /**
         * AJAX ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°
         * @param {string} lectId - ê°•ì˜ ID
         */
        const addToCart = (lectId) => {
            $.ajax({
                url: '/user/payment/ajaxAddToCart',
                type: 'POST',
                data: { lectId: lectId },
                success: function (res) {
                    if (res === 'success') {
                        // ë°°ì§€ ì¹´ìš´íŠ¸ ì¦ê°€ ë° ì• ë‹ˆë©”ì´ì…˜
                        state.cartCount++;
                        cartBadge.textContent = state.cartCount;
                        cartBadge.classList.remove('hidden');
                        cartBadge.classList.add('flex');
                        cartBadge.classList.add('scale-125');
                        setTimeout(() => cartBadge.classList.remove('scale-125'), 200);

                        showToast('ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤! ğŸ›’', 'success');

                    } else if (res === 'duplicate') {
                        // ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ê°•ì˜
                        showToast('ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ê°•ì˜ì…ë‹ˆë‹¤.', 'warn');

                    } else if (res === 'login_required') {
                        // ë¡œê·¸ì¸ í•„ìš”
                        if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?')) {
                            location.href = '/common/member/loginFrm';
                        }
                    }
                },
                error: function () {
                    showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                }
            });
        };

        // --- Event Initializers ---
        const handleSearch = (e) => {
            state.searchQuery = e.target.value;
            state.currentPage = 1;
            state.page1Current = 10;
            renderCourses(true);
        };

        searchInput.addEventListener('input', handleSearch);
        resetSearchBtn.addEventListener('click', () => {
            state.searchQuery = '';
            state.activeCategory = 'all';
            searchInput.value = '';
            state.currentPage = 1;
            state.page1Current = 10;
            renderCategories();
            renderCourses(true);
        });

        window.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderCourses();
            setupIntersectionObserver();

            /* ì •ë ¬ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ */
            const sortToggle = document.getElementById('sort-toggle-btn');
            const sortMenu = document.getElementById('sort-menu');
            const sortLabel = document.getElementById('sort-label');

            sortToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                sortMenu.classList.toggle('hidden');
            });

            document.querySelectorAll('.sort-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    sortLabel.textContent = opt.textContent;
                    /* ì„ íƒëœ í•­ëª© ìŠ¤íƒ€ì¼ ë³€ê²½ */
                    document.querySelectorAll('.sort-option').forEach(o => {
                        o.classList.remove('text-gray-900', 'font-bold');
                        o.classList.add('text-gray-600');
                    });
                    opt.classList.add('text-gray-900', 'font-bold');
                    opt.classList.remove('text-gray-600');
                    sortMenu.classList.add('hidden');
                });
            });

            /* ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸° */
            document.addEventListener('click', () => {
                sortMenu.classList.add('hidden');
            });

            const swiper = new Swiper(".mySwiper", {
                loop: true,
                effect: 'fade', // Fade effect for cleaner look
                fadeEffect: { crossFade: true },
                autoplay: { delay: 4000, disableOnInteraction: false },
                pagination: { el: ".swiper-pagination", clickable: true },
                navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
            });
            lucide.createIcons();

            // Scroll to Top ë²„íŠ¼
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollTopBtn.classList.remove('hidden');
                } else {
                    scrollTopBtn.classList.add('hidden');
                }
            });
            scrollTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>

</html>