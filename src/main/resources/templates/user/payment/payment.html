<script th:inline="javascript">
    // 문서가 로드되면 실행
    function payToss() {
        // [중요] 내 클라이언트 키로 변경하세요
        var clientKey = 'test_ck_Z1aOwX7K8mz4qRa9nBwA3yQxzvNP'; 
        var tossPayments = TossPayments(clientKey);

        // 주문번호 생성 (현재시간 + 난수 등으로 고유하게 생성)
        var orderId = 'ORDER_' + new Date().getTime(); 
        
        // [수정 부분] -------------------------------------------------------
        // IDE 에러 방지: /*[[ 타임리프변수 ]]*/ 기본값; 형태로 작성합니다.
        // 이렇게 하면 이클립스는 주석 안을 무시하고 뒤에 있는 0을 변수값으로 인식해 에러를 내지 않습니다.
        // 실행 시(서버)에는 주석 부분이 실제 값으로 치환됩니다.
        var amount = /*[[${totalPrice != null ? totalPrice : 0}]]*/ 0;
        var customerName = /*[[${session.userName}]]*/ '구매자';
        // ------------------------------------------------------------------
        
        if(amount <= 0) {
            alert("결제할 금액이 없습니다.");
            return;
        }

        // 2. 결제창 호출
        tossPayments.requestPayment('카드', { 
            amount: amount, 
            orderId: orderId, 
            orderName: '자바 스프링 강의 외', 
            customerName: customerName, 
            successUrl: window.location.origin + '/user/payment/toss/success', 
            failUrl: window.location.origin + '/user/payment/toss/fail', 
        })
        .catch(function (error) {
            if (error.code === 'USER_CANCEL') {
                alert('결제를 취소했습니다.');
            } else {
                alert('결제 실패: ' + error.message);
            }
        });
    }
</script>