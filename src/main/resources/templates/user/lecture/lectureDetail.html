<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${allDetail.detail.name}">ê°•ì˜ ìƒì„¸ì •ë³´</title>
    <link rel="stylesheet" th:href="@{/css/user/lectureDetail.css}" />
    <th:block th:replace="~{fragments/cdn :: cdn}"></th:block>

    <style type="text/css">
      #wrap {
        margin: 0px auto;
        width: 1200px;
        height: 1000px;
      }

      #header {
        height: 150px;
      }

      #container {
        height: 700px;
      }

      #footer {
        height: 150px;
      }

      .thumb {
        width: 80%;
        border-radius: 5px;
      }
    </style>

    <!--JS ì‹¤ìŠµ íŒŒíŠ¸-->
    <script type="text/javascript">
      $(function () {}); //document.ready
      /**
      * ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° AJAX (ê¸°ë³¸ ì•Œë¦¼ì°½ ë°©ì‹)
      */
     function addToCart(lectId) {
         $.ajax({
             url: '/user/payment/ajaxAddToCart',
             type: 'POST',
             data: { lectId: lectId },
             success: function (res) {
                 if (res === 'success') {
                     if (confirm('ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤! ğŸ›’\nì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                         location.href = '/user/payment/searchMyCart';
                     }
                 } else if (res === 'duplicate') {
                     alert('ì´ë¯¸ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ê°•ì˜ì…ë‹ˆë‹¤.');
                 } else if (res === 'login_required') {
                     if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?')) {
                         location.href = '/common/member/loginFrm';
                     }
                 }
             },
             error: function () {
                 alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
             }
         });
     }
    </script>
  </head>
  <body>
    <div id="header">
      <th:block th:replace="~{fragments/MyHeader :: header}" />
    </div>
    <div id="wrap">
      <div class="container mt-5">
        <div class="row" th:object="${allDetail.detail}">
          <div class="col-md-4">
            <img
              th:src="|${imgPath}*{thumbnail}|"
              onerror="this.src = '/common/images/default.png'"
              class="img-fluid"
              alt="ê°•ì˜ ì¸ë„¤ì¼"
            />
          </div>
          <div class="col-md-8">
            <div
              class="badge bg-emerald-100 text-emerald-700 px-3 py-2 rounded-pill mb-3"
              style="
                background-color: #ecfdf5;
                color: #059669;
                font-weight: 700;
              "
            >
              <i data-lucide="tag" class="w-3 h-3 d-inline-block me-1"></i>
              <span th:text="*{catName}">ì¹´í…Œê³ ë¦¬ëª…</span>
            </div>

            <h2 th:text="*{name}">ê°•ì˜ëª…</h2>
            <p class="text-muted mb-4" th:text="*{shortint}">ê°•ì˜ í•œ ì¤„ ì†Œê°œ</p>

            <div class="skill-tags mb-4">
              <span
                th:each="skill : ${skillList}"
                th:text="${skill}"
                class="badge border me-2 py-2 px-3 text-secondary"
                style="border-radius: 8px; font-weight: 500; background: #fff"
              >
                Java
              </span>
            </div>

            <div class="d-flex align-items-center gap-3">
              <h3
                class="text-primary mb-0"
                th:text="*{price == 0 ? 'ë¬´ë£Œ' : #numbers.formatInteger(price, 3, 'COMMA') + 'ì›'}"
              >
                ê°€ê²©
              </h3>
            </div>

			<div class="mt-4 d-flex justify-content-start">
    <button type="button" 
            th:onclick="addToCart([[${allDetail.detail.lectId}]])"
            class="btn btn-primary btn-lg d-flex align-items-center justify-content-center gap-2"
            style="width: 50%; height: 54px; font-weight: 800;">
        <i data-lucide="shopping-cart" class="w-5 h-5"></i>
        <span>ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</span>
    </button>
</div>

          </div>
        </div>

        <div class="mt-5">
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item shadow-sm">
              <button
                class="nav-link active"
                data-bs-toggle="tab"
                data-bs-target="#tab-intro"
              >
                ê°•ì˜ ì†Œê°œ
              </button>
            </li>
            <li class="nav-item shadow-sm">
              <button
                class="nav-link"
                data-bs-toggle="tab"
                data-bs-target="#tab-curriculum"
              >
                êµìœ¡ ê³¼ì •
              </button>
            </li>
            <li class="nav-item shadow-sm">
              <button
                class="nav-link"
                data-bs-toggle="tab"
                data-bs-target="#tab-reviews"
              >
                ìˆ˜ê°•í‰
              </button>
            </li>
          </ul>

          <div class="tab-content p-4 border border-top-0">
            <div class="tab-pane fade show active" id="tab-intro">
              <div th:utext="${allDetail.detail.intro}">ê°•ì˜ ìƒì„¸ ë‚´ìš©</div>
            </div>

            <div class="tab-pane fade" id="tab-curriculum">
              <div class="content-box mt-3">
                <table class="table table-hover align-middle">
                  <thead class="table-light">
                    <tr>
                      <th style="width: 10%">ë²ˆí˜¸</th>
                      <th style="width: 50%">ê°•ì˜ëª…</th>
                      <th style="width: 20%">ê°•ì˜ì‹œê°„</th>
                      <th style="width: 20%; text-align: center">ê°•ì˜ìë£Œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:if="${#lists.isEmpty(allDetail.chapter)}">
                      <td colspan="4" class="text-center py-4 text-muted">
                        ë“±ë¡ëœ ì»¤ë¦¬í˜ëŸ¼ì´ ì—†ìŠµë‹ˆë‹¤.
                      </td>
                    </tr>

                    <tr
                      th:each="item, i : ${allDetail.chapter}"
                      th:object="${item}"
                    >
                      <td th:text="${i.count}">1</td>

                      <td>
                        <i class="bi bi-play-circle me-2 text-primary"></i>
                        <span th:text="*{name}">ê°•ì˜ ì œëª©</span>
                      </td>

                      <td th:text="*{lengthStr}">10:00</td>

                      <td class="text-center">
                        <th:block th:if="*{not #strings.isEmpty(doc)}">
                          <span
                            class="badge rounded-pill bg-light text-dark border"
                          >
                            <i class="bi bi-file-earmark-arrow-down"></i> ìë£Œ
                            í¬í•¨
                          </span>
                        </th:block>
                        <span
                          th:unless="*{not #strings.isEmpty(doc)}"
                          class="text-muted small"
                          >-</span
                        >
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="tab-pane fade" id="tab-reviews">
              <div
                th:if="${#lists.isEmpty(allDetail.review)}"
                class="text-center py-5"
              >
                <p>
                  ì•„ì§ ì‘ì„±ëœ ìˆ˜ê°•í‰ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ìˆ˜ê°•í‰ì„ ë‚¨ê²¨ë³´ì„¸ìš”!
                </p>
              </div>
              <div
                th:each="rev : ${allDetail.review}"
                class="mb-4 pb-3 border-bottom"
              >
                <div class="d-flex justify-content-between">
                  <strong th:text="${rev.user_id}">ì‘ì„±ì</strong>
                  <span class="text-warning" th:text="${'â˜…'.repeat(rev.score)}"
                    >ë³„ì </span
                  >
                </div>
                <p class="mt-2" th:text="${rev.content}">ìˆ˜ê°•í‰ ë‚´ìš©</p>
                <small
                  class="text-muted"
                  th:text="${#dates.format(rev.regdate, 'yyyy-MM-dd')}"
                  >ë‚ ì§œ</small
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--"wrap" -->
    <div id="footer">
      <th:block th:replace="~{fragments/footer :: footer}" />
    </div>
  </body>
</html>
